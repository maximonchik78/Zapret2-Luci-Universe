name: Simple Build Test

on:
  push:
    branches: [main]
  pull_request:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: List files
      run: |
        echo "ğŸ“ Repository structure:"
        find . -type f -name "*.lua" -o -name "*.htm" -o -name "*.sh" | head -20
        echo ""
        echo "ğŸ“¦ Total files: $(find . -type f | wc -l)"
    
    - name: Validate structure
      run: |
        echo "ğŸ” Checking required files:"
        
        # Check for essential files
        if [ -f "Makefile" ]; then
          echo "âœ… Makefile found"
        else
          echo "âŒ Makefile missing"
        fi
        
        if [ -f "README.md" ]; then
          echo "âœ… README.md found"
        else
          echo "âŒ README.md missing"
        fi
        
        if [ -d "files" ]; then
          echo "âœ… files/ directory found"
          echo "   Files in files/: $(find files -type f | wc -l)"
        else
          echo "âŒ files/ directory missing"
        fi
        
        # Check LuCI controller
        if [ -f "files/usr/lib/lua/luci/controller/zapret2.lua" ]; then
          echo "âœ… LuCI controller found"
        else
          echo "âš ï¸  LuCI controller not found"
        fi
        
    - name: Create test package
      run: |
        # Create a simple test package
        mkdir -p output
        cat > output/test.info << 'EOF'
Package: luci-app-zapret2-test
Version: 1.0.0-test
Description: Test package for GitHub Actions verification
Architecture: all
Status: ok
Build: successful
Timestamp: $(date)
EOF
        
        echo "ğŸ“¦ Test package created successfully!"
    
    - name: Upload test results
      uses: actions/upload-artifact@v3
      with:
        name: build-test-results
        path: output/
        retention-days: 7
