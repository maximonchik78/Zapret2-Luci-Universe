name: Code Quality Check

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Lua syntax check
        run: |
          echo "üîß Checking Lua syntax..."
          find . -name "*.lua" -type f | while read file; do
            if luac -p "$file" 2>/dev/null; then
              echo "‚úÖ $file - syntax OK"
            else
              echo "‚ùå $file - syntax error"
              luac -p "$file"
            fi
          done
      
      - name: Shell script check
        run: |
          echo "üîß Checking shell scripts..."
          find . -name "*.sh" -type f | while read file; do
            if shellcheck "$file" 2>/dev/null; then
              echo "‚úÖ $file - shellcheck passed"
            else
              echo "‚ö†Ô∏è $file - shellcheck warnings"
              shellcheck "$file" || true
            fi
          done
      
      - name: YAML syntax check
        run: |
          echo "üîß Checking YAML files..."
          find . -name "*.yml" -o -name "*.yaml" | while read file; do
            if python3 -c "import yaml; yaml.safe_load(open('$file'))" 2>/dev/null; then
              echo "‚úÖ $file - YAML syntax OK"
            else
              echo "‚ùå $file - YAML syntax error"
            fi
          done
