name: Quick Test

on:
  push:
    branches: [ main, master ]
  pull_request:
  workflow_dispatch:

jobs:
  test-structure:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate repository structure
        run: |
          echo "ğŸ” Checking repository structure..."
          
          # Required files
          REQUIRED_FILES=("Makefile" "README.md" "files/usr/lib/lua/luci/controller/zapret2.lua")
          
          for file in "${REQUIRED_FILES[@]}"; do
            if [ -f "$file" ] || [ -d "$file" ]; then
              echo "âœ… $file exists"
            else
              echo "âŒ $file is missing"
              exit 1
            fi
          done
          
          # Count files
          echo ""
          echo "ğŸ“Š File statistics:"
          echo "LuCI files: $(find files/usr/lib/lua/luci -type f 2>/dev/null | wc -l || echo 0)"
          echo "HTML files: $(find files -name "*.htm" -o -name "*.html" 2>/dev/null | wc -l || echo 0)"
          echo "Shell scripts: $(find files -name "*.sh" 2>/dev/null | wc -l || echo 0)"
          
          # Validate Makefile
          echo ""
          echo "ğŸ“‹ Makefile check:"
          if grep -q "PKG_NAME.*luci-app-zapret2" Makefile; then
            echo "âœ… PKG_NAME is correct"
          else
            echo "âŒ PKG_NAME is incorrect"
          fi
          
          if grep -q "LUCI_TITLE.*Zapret2" Makefile; then
            echo "âœ… LUCI_TITLE is set"
          else
            echo "âš ï¸ LUCI_TITLE might be missing"
          fi

      - name: Create test package info
        run: |
          mkdir -p test-output
          cat > test-output/package.info << 'EOF'
Package: luci-app-zapret2
Version: 2.0.0-test
Architecture: all
Description: Test package info for validation
Maintainer: maximonchik78
Depends: luci-compat, luci-lib-ipkg
Status: test-ready
Build-System: GitHub Actions
Timestamp: $(date -u)
EOF
          
          echo "ğŸ“¦ Test package info created"
          cat test-output/package.info

      - name: Upload test results
        uses: actions/upload-artifact@v4
        with:
          name: test-validation
          path: test-output/
          retention-days: 7
