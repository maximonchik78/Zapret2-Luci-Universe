<%+header%>
<div class="cbi-map">
    <h2 name="content"><%:Install/Update Zapret2%></h2>
    <div class="cbi-map-descr">
        <%:This wizard will guide you through installing or updating zapret2 on your router.%>
    </div>
    
    <div class="cbi-section">
        <form method="post" action="<%=url('admin/services/zapret2/install')%>">
            <input type="hidden" name="action" value="download">
            
            <div class="cbi-section-node">
                <div class="cbi-value">
                    <label class="cbi-value-title"><%:Current Architecture%></label>
                    <div class="cbi-value-field">
                        <code><%=luci.sys.exec("opkg print-architecture | awk 'NR>2 {print $2}' | head -1")%></code>
                    </div>
                </div>
                
                <div class="cbi-value">
                    <label class="cbi-value-title"><%:Available Space%></label>
                    <div class="cbi-value-field">
                        <code><%=luci.sys.exec("df -h /usr | tail -1 | awk '{print $4}'")%></code>
                    </div>
                </div>
                
                <div class="cbi-value">
                    <label class="cbi-value-title"><%:Current Version%></label>
                    <div class="cbi-value-field">
                        <% 
                        local version = luci.sys.exec("zapret --version 2>/dev/null | head -1 || echo 'Not installed'")
                        if version:match("Not installed") then
                        %>
                            <span class="label label-danger"><%=version%></span>
                        <% else %>
                            <span class="label label-success"><%=version%></span>
                        <% end %>
                    </div>
                </div>
                
                <div class="cbi-value">
                    <div class="cbi-value-field">
                        <div class="alert alert-info">
                            <i class="icon icon-info"></i>
                            <%:This will download the latest version of zapret2 from GitHub and install it on your router. 
                            The process may take several minutes depending on your internet connection.%>
                        </div>
                    </div>
                </div>
                
                <div class="cbi-value cbi-value-last">
                    <div class="cbi-value-field">
                        <input type="submit" class="cbi-button cbi-button-positive" value="<%:Check for Updates%>">
                        <a href="<%=url('admin/services/zapret2/status')%>" class="cbi-button"><%:Cancel%></a>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    <div class="cbi-section">
        <h3><%:Manual Installation%></h3>
        <div class="cbi-section-descr">
            <%:If automatic installation fails, you can manually install zapret2:%>
        </div>
        
        <div class="cbi-section-node">
            <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px;">
# Download and install manually
opkg update
opkg install curl wget tar
wget https://github.com/bol-van/zapret/releases/latest/download/zapret-openwrt-*.tar.gz
tar -xzf zapret-openwrt-*.tar.gz
cd zapret
./install.sh
            </pre>
        </div>
    </div>
</div>
<%+footer%>
