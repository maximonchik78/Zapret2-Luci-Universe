#!/bin/sh /etc/rc.common

START=99
STOP=10
USE_PROCD=1

NAME=zapret
PROG=/usr/bin/zapret
CONFIG=/etc/zapret/config.ini
PIDFILE=/var/run/zapret.pid
LOGFILE=/var/log/zapret.log

start_service() {
    procd_open_instance
    procd_set_param command "$PROG" start --config "$CONFIG"
    procd_set_param respawn
    procd_set_param pidfile "$PIDFILE"
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param user root
    procd_close_instance
}

stop_service() {
    if [ -f "$PIDFILE" ]; then
        kill $(cat "$PIDFILE") 2>/dev/null
        rm -f "$PIDFILE"
    fi
}

restart() {
    stop
    sleep 2
    start
}

reload() {
    if [ -f "$PIDFILE" ]; then
        kill -HUP $(cat "$PIDFILE") 2>/dev/null
    fi
}

boot() {
    local enabled
    config_load zapret2
    config_get_bool enabled config enabled 0
    
    if [ "$enabled" = "1" ]; then
        start
    fi
}
